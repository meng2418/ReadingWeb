openapi: 3.0.0
info:
  title: 微信读书网页版 API
  description: 根据前端需求整理的接口文档
  version: 2.0.0

servers:
  - url: http://localhost:3000/api/v1
    description: 开发环境

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    # ==================== 通用数据结构 ====================
    ApiResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: "success"
        data:
          type: object
          nullable: true

    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
          example: 400
        message:
          type: string
        details:
          type: string

    # ==================== 书籍相关 ====================
    SimpleBook:
      type: object
      properties:
        cover:
          type: string
          format: uri
          description: 封面图URL
        bookTitle:
          type: string
          description: 书名
        author:
          type: string
          description: 作者名
        rating:
          type: number
          format: float
          description: 推荐值
        readCount:
          type: integer
          description: 今日阅读人数
        description:
          type: string
          description: 作品简介
        isFinished:
          type: boolean
          description: 是否读完

    BookDetail:
      allOf:
        - $ref: '#/components/schemas/SimpleBook'
        - type: object
          properties:
            isInBookshelf:
              type: boolean
              description: 是否加入书架
            hasStarted:
              type: boolean
              description: 是否开始阅读
            readingCount:
              type: integer
              description: 在读人数
            finishedCount:
              type: integer
              description: 读完人数
            readingStatus:
              type: string
              enum: [not_started, reading, finished]
              description: 我的阅读状态
            wordCount:
              type: integer
              description: 字数
            publishDate:
              type: string
              format: date
              description: 出版时间
            isFreeForMember:
              type: boolean
              description: 体验卡是否可读
            price:
              type: integer
              description: 电子书价格（分）
            ratingDetail:
              type: object
              properties:
                recommendPercent:
                  type: number
                  format: float
                averagePercent:
                  type: number
                  format: float
                notRecommendPercent:
                  type: number
                  format: float
            ratingCount:
              type: integer
              description: 点评人数
            authorBio:
              type: string
              description: 作者简介

    # ==================== 用户相关 ====================
    UserSimpleVO:
      type: object
      properties:
        userId:
          type: integer
        username:
          type: string
        avatar:
          type: string
          format: uri
        bio:
          type: string
    
    UserProfile:
      type: object
      properties:
        avatar:
          type: string
          format: uri
          description: 用户头像
        username:
          type: string
          description: 用户名
        bio:
          type: string
          description: 用户简介
        followingCount:
          type: integer
          description: 关注数
        followerCount:
          type: integer
          description: 粉丝数
        postCount:
          type: integer
          description: 帖子数
        memberCardCount:
          type: integer
          description: 体验卡数
        coinCount:
          type: integer
          description: 充值币数
        isMember:
          type: boolean
          description: 是否是会员
        memberExpireDays:
          type: integer
          description: 会员剩余天数
        readingStats:
          type: object
          properties:
            weeklyReadingTime:
              type: integer
              description: 周阅读时长（分钟）
            monthlyReadingTime:
              type: integer
              description: 月阅读时长（分钟）
            yearlyReadingTime:
              type: integer
              description: 年阅读时长（分钟）
            totalReadingTime:
              type: integer
              description: 总阅读时长（分钟）
            weeklyBooksRead:
              type: array
              description: 本周读过的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            monthlyBooksRead:
              type: array
              description: 本月读过的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            yearlyBooksRead:
              type: array
              description: 今年读过的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            totalBooksRead:
              type: array
              description: 总共读过的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            weeklyBooksFinished:
              type: array
              description: 本周读完的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            monthlyBooksFinished:
              type: array
              description: 本月读完的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            yearlyBooksFinished:
              type: array
              description: 今年读完的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            totalBooksFinished:
              type: array
              description: 总共读完的书籍列表
              items:
                $ref: '#/components/schemas/SimpleBook'
            weeklyNoteCount:
              type: integer
              description: 周笔记数量
            monthlyNoteCount:
              type: integer
              description: 月笔记数量
            yearlyNoteCount:
              type: integer
              description: 年笔记数量
            totalNoteCount:
              type: integer
              description: 总笔记数量
        consecutiveReadingDays:
          type: integer
          description: 连续阅读天数

    # ==================== 帖子相关 ====================
    Post:
      type: object
      properties:
        postId:
          type: integer
        authorAvatar:
          type: string
          format: uri
          description: 作者头像
        authorName:
          type: string
          description: 作者名字
        publishTime:
          type: string
          format: date-time
          description: 发布时间
        publishLocation:
          type: string
          description: 发布地点
        isFollowingAuthor:
          type: boolean
          description: 登录用户是否关注作者
        postTitle:
          type: string
          description: 帖子标题
        content:
          type: string
          description: 帖子正文
        mentionedBooks:
          type: array
          items:
            $ref: '#/components/schemas/SimpleBook'
          description: 帖子提及书籍列表
        commentCount:
          type: integer
          description: 评论数
        likeCount:
          type: integer
          description: 点赞数
        isLiked:
          type: boolean
          description: 是否已点赞
        topics:
          type: array
          items:
            type: string
          description: 话题列表

    # ==================== 话题相关 ====================
    Topic:
      type: object
      properties:
        image:
          type: string
          format: uri
          description: 话题图片
        name:
          type: string
          description: 话题名称
        postCount:
          type: integer
          description: 话题帖子数
        description:
          type: string
          description: 话题简介
        followerCount:
          type: integer
          description: 话题关注人数
        todayPostCount:
          type: integer
          description: 话题今日发帖数
        isFollowing:
          type: boolean
          description: 是否关注话题
        introduction:
          type: string
          description: 话题介绍内容
        createdAt:
          type: string
          format: date-time
          description: 创建时间
        adminName:
          type: string
          description: 管理员名字
        relatedTopics:
          type: array
          items:
            type: object
            properties:
              image:
                type: string
                format: uri
              name:
                type: string
              postCount:
                type: integer

    # ==================== 评论相关 ====================
    Comment:
      type: object
      properties:
        avatar:
          type: string
          format: uri
          description: 评论头像
        username:
          type: string
          description: 评论用户名称
        commentTime:
          type: string
          format: date-time
          description: 评论时间
        content:
          type: string
          description: 评论内容
        likeCount:
          type: integer
          description: 评论点赞数
        replyCount:
          type: integer
          description: 子评论数
        isLiked:
          type: boolean
          description: 是否已点赞

    # ==================== 搜索相关 ====================
    SearchResult:
      type: object
      properties:
        books:
          type: array
          items:
            $ref: '#/components/schemas/SimpleBook'
        authors:
          type: array
          items:
            type: object
            properties:
              avatar:
                type: string
                format: uri
              followerCount:
                type: integer
              name:
                type: string
              representativeWork:
                type: string
              bio:
                type: string

    # ==================== 阅读相关 ====================
    Chapter:
      type: object
      properties:
        startPage:
          type: integer
        chapterNumber:
          type: integer
        chapterName:
          type: string

    ChapterDetail:
      type: object
      properties:
        chapterId:
          type: integer
          description: 章节ID
        bookId:
          type: integer
          description: 书籍ID
        title:
          type: string
          description: 章节标题
        chapterNumber:
          type: integer
          description: 章节序号
        content:
          type: string
          description: 章节正文内容
        wordCount:
          type: integer
          description: 章节字数
        isVip:
          type: boolean
          description: 是否VIP章节
        isPublished:
          type: boolean
          description: 是否已发布
        prevChapterId:
          type: integer
          nullable: true
          description: 上一章ID
        nextChapterId:
          type: integer
          nullable: true
          description: 下一章ID
        readCount:
          type: integer
          description: 阅读人数
        createdAt:
          type: string
          format: date-time
          description: 创建时间
        updatedAt:
          type: string
          format: date-time
          description: 更新时间

    Bookmark:
      type: object
      properties:
        bookmarkId:
          type: integer
          description: 书签ID
        bookId:
          type: integer
          description: 书籍ID
        bookTitle:
          type: string
          description: 书籍标题
        chapterId:
          type: integer
          description: 章节ID
        chapterTitle:
          type: string
          description: 章节标题
        pageNumber:
          type: integer
          nullable: true
          description: 页码
        note:
          type: string
          nullable: true
          description: 书签备注
        createdAt:
          type: string
          format: date-time
          description: 创建时间

    ReadingStat:
      type: object
      properties:
        userId:
          type: integer
          description: 用户ID
        todayReadingMinutes:
          type: integer
          description: 今日阅读时长（分钟）
        totalReadingMinutes:
          type: integer
          description: 总阅读时长（分钟）
        consecutiveDays:
          type: integer
          description: 连续阅读天数
        totalBooksRead:
          type: integer
          description: 总阅读书籍数

    Note:
      type: object
      properties:
        quote:
          type: string
          description: 引用内容
        noteCount:
          type: integer
          description: 笔记数
        noteTime:
          type: string
          format: date-time
          description: 笔记时间

    Highlight:
      type: object
      properties:
        bookTitle:
          type: string
        content:
          type: string
        chapterName:
          type: string
        highlightDate:
          type: string
          format: date

    BookNote:
      type: object
      properties:
        bookTitle:
          type: string
        quote:
          type: string
        noteContent:
          type: string
        noteDate:
          type: string
          format: date

    BookReview:
      type: object
      properties:
        cover:
          type: string
          format: uri
        bookTitle:
          type: string
        reviewDate:
          type: string
          format: date
        helpfulCount:
          type: integer
        reviewContent:
          type: string
        rating:
          type: string
          enum: [recommend, average, not_recommend]

    ReadingRecord:
      type: object
      properties:
        cover:
          type: string
          format: uri
        title:
          type: string
        readingTime:
          type: integer
          description: 阅读时长（分钟）

    # ==================== 支付相关 ====================
    RechargePackage:
      type: object
      properties:
        coinAmount:
          type: integer
          description: 充值币数
        cnyAmount:
          type: number
          format: float
          description: 人民币数
        bonusCoins:
          type: integer
          description: 赠送充值币数

    PaymentInfo:
      type: object
      properties:
        coinAmount:
          type: integer
          description: 充值币数
        bonusCoins:
          type: integer
          description: 赠送币数
        actualAmount:
          type: number
          format: float
          description: 实付金额
        paymentMethods:
          type: array
          items:
            type: string
            enum: [wechat, alipay, unionpay]
          description: 支付方式

  requestBodies:
    # ==================== 认证相关 ====================
    SendSmsRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'

    RegisterRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              username:
                type: string
                minLength: 2
                maxLength: 20
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'
              verificationCode:
                type: string
                pattern: '^\d{6}$'
              password:
                type: string
                minLength: 6
              confirmPassword:
                type: string
            required: [username, phone, verificationCode, password, confirmPassword]

    LoginRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'
              type:
                type: string
                enum: [password, verificationCode]
              password:
                type: string
                nullable: true
              verificationCode:
                type: string
                nullable: true
            required: [phone, type]

    ResetPasswordRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'
              verificationCode:
                type: string
                pattern: '^\d{6}$'
              newPassword:
                type: string
                minLength: 6
              confirmPassword:
                type: string
            required: [phone, verificationCode, newPassword, confirmPassword]

    # ==================== 内容发布相关 ====================
    PublishBookReviewRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              bookId:
                type: integer
              rating:
                type: string
                enum: [recommend, average, not_recommend]
              content:
                type: string
                minLength: 10
              isPublic:
                type: boolean
                default: true
            required: [bookId, rating, content]

    PublishNoteRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              bookId:
                type: integer
              chapterId:
                type: integer
              quote:
                type: string
              lineType:
                type: string
                enum: [marker, wavy, straight]
              noteContent:
                type: string
            required: [bookId, quote, noteContent]

    PublishPostRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                minLength: 1
              content:
                type: string
                minLength: 1
              bookIds:
                type: array
                items:
                  type: integer
              hashtags:
                type: array
                items:
                  type: string
            required: [title, content]

    PublishCommentRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              postId:
                type: integer
              content:
                type: string
                minLength: 1
              parentId:
                type: integer
                nullable: true
            required: [postId, content]

    # ==================== 用户操作相关 ====================
    UpdateProfileRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              avatar:
                type: string
                format: uri
                nullable: true
              username:
                type: string
                minLength: 2
                maxLength: 20
                nullable: true
              bio:
                type: string
                maxLength: 200
                nullable: true

    RechargeRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              packageId:
                type: integer
              paymentMethod:
                type: string
                enum: [wechat, alipay, unionpay]
            required: [packageId, paymentMethod]

    # ==================== 交互相关 ====================
    FollowRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              userId:
                type: integer
            required: [userId]

    LikeRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              targetId:
                type: integer
              targetType:
                type: string
                enum: [post, comment]
            required: [targetId, targetType]

    # ==================== 书籍管理相关 ====================
    BookCreateRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                minLength: 1
                description: 书籍标题
              authorId:
                type: integer
                description: 作者ID
              cover:
                type: string
                format: uri
                nullable: true
                description: 封面URL
              description:
                type: string
                nullable: true
                description: 简介
              categoryId:
                type: integer
                description: 分类ID
              publisher:
                type: string
                nullable: true
                description: 出版社
              isbn:
                type: string
                nullable: true
                description: ISBN号
              price:
                type: integer
                default: 0
                description: 价格（分）
              isFree:
                type: boolean
                default: false
                description: 是否免费
              isMemberOnly:
                type: boolean
                default: false
                description: 是否会员专属
              tags:
                type: string
                nullable: true
                description: 标签（逗号分隔）
            required: [title, authorId, categoryId]

    BookUpdateRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                nullable: true
              authorId:
                type: integer
                nullable: true
              cover:
                type: string
                format: uri
                nullable: true
              description:
                type: string
                nullable: true
              categoryId:
                type: integer
                nullable: true
              publisher:
                type: string
                nullable: true
              isbn:
                type: string
                nullable: true
              price:
                type: integer
                nullable: true
              isFree:
                type: boolean
                nullable: true
              isPublished:
                type: boolean
                nullable: true
                description: 上架/下架
              isMemberOnly:
                type: boolean
                nullable: true
              tags:
                type: string
                nullable: true

    ChapterCreateRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                minLength: 1
                description: 章节标题
              chapterNumber:
                type: integer
                description: 章节序号
              content:
                type: string
                minLength: 1
                description: 章节正文内容
              isVip:
                type: boolean
                default: false
                description: 是否VIP章节
              isPublished:
                type: boolean
                default: true
                description: 是否发布
            required: [title, chapterNumber, content]

    BookmarkCreateRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              bookId:
                type: integer
                description: 书籍ID
              chapterId:
                type: integer
                description: 章节ID
              pageNumber:
                type: integer
                nullable: true
                description: 页码
              note:
                type: string
                nullable: true
                description: 书签备注
            required: [bookId, chapterId]

    NoteUpdateRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              content:
                type: string
                nullable: true
                description: 笔记内容
              isPublic:
                type: boolean
                nullable: true
                description: 是否公开
              color:
                type: string
                nullable: true
                description: 标注颜色

    ReadingRecordRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              bookId:
                type: integer
                description: 书籍ID
              chapterId:
                type: integer
                description: 章节ID
              pageNumber:
                type: integer
                nullable: true
                description: 页码
            required: [bookId, chapterId]

paths:
  # ==================== 认证相关接口 ====================
  /auth/send-verification-code:
    post:
      summary: 发送验证码
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone]
              properties:
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
      responses:
        200:
          description: 验证码发送成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        429:
          description: 请求过于频繁
          $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      summary: 注册
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, phone, verificationCode, password, confirmPassword]
              properties:
                username:
                  type: string
                  minLength: 2
                  maxLength: 20
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                verificationCode:
                  type: string
                  pattern: '^\d{6}$'
                password:
                  type: string
                  minLength: 6
                confirmPassword:
                  type: string
      responses:
        201:
          description: 注册成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/UserSimpleVO'
                          token:
                            type: string
        400:
          $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      summary: 登录
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, type]
              properties:
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                type:
                  type: string
                  enum: [password, verificationCode]
                password:
                  type: string
                  nullable: true
                verificationCode:
                  type: string
                  nullable: true
      responses:
        200:
          description: 登录成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/UserSimpleVO'
                          token:
                            type: string
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          description: 用户名或密码错误
          $ref: '#/components/schemas/ErrorResponse'
  /auth/reset-password:
    post:
      summary: 找回密码
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, verificationCode, newPassword, confirmPassword]
              properties:
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                verificationCode:
                  type: string
                  pattern: '^\d{6}$'
                newPassword:
                  type: string
                  minLength: 6
                confirmPassword:
                  type: string
      responses:
        200:
          description: 密码重置成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 首页相关接口 ====================
  /home/reading-stats:
    get:
      summary: 获取本周/月/总阅读时长
      tags: [首页]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          weeklyReadingTime:
                            type: integer
                          monthlyReadingTime:
                            type: integer
                          totalReadingTime:
                            type: integer

  /home/recommendations:
    get:
      summary: 获取猜你想看书籍（6本）
      tags: [首页]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 返回6本推荐书籍
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 6  # 明确6本
                        minItems: 6  # 保证至少6本
                        items:
                          $ref: '#/components/schemas/SimpleBook'

  /home/rankings/{type}:
    get:
      summary: 获取书籍榜单（10本）
      tags: [首页]
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [weekly, monthly, new, masterpiece]
          description: |
            - weekly: 周榜
            - monthly: 月榜  
            - new: 新书榜
            - masterpiece: 神作榜
      responses:
        200:
          description: 返回10本榜单书籍
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 10  # 明确10本
                        minItems: 10  # 保证至少10本
                        items:
                          $ref: '#/components/schemas/SimpleBook'

  # ==================== 分类相关接口 ====================
  /categories:
    get:
      summary: 获取全部分类
      tags: [分类]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            categoryName:
                              type: string

  /categories/{categoryId}/books:
    get:
      summary: 获取分类下的书籍（最多50本）
      tags: [分类]
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50  # 默认50本
            minimum: 1
            maximum: 50  # 限制最多50本
      responses:
        200:
          description: 返回分类书籍列表
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          books:
                            type: array
                            maxItems: 50  # 明确最多50本
                            items:
                              $ref: '#/components/schemas/SimpleBook'
                          total:
                            type: integer
                            description: 该分类下书籍总数
                          page:
                            type: integer
                          limit:
                            type: integer

  # ==================== 书架相关接口 ====================
  /bookshelf:
    get:
      summary: 获取书架全部书籍
      tags: [书架]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/SimpleBook'
                            - type: object
                              properties:
                                isFinished:
                                  type: boolean

  /bookshelf/{status}:
    get:
      summary: 获取书架未读/在读/读完书籍
      tags: [书架]
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
            enum: [unread, reading, finished]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            cover:
                              type: string
                              format: uri
                            title:
                              type: string

  # ==================== 社区相关接口 ====================
  /posts:
    get:
      summary: 获取广场/关注页帖子
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum: [square, following]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Post'

    post:
      summary: 发布帖子
      tags: [社区]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/PublishPostRequest'
      responses:
        201:
          description: 发布成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Post'

  /posts/{postId}:
    get:
      summary: 获取帖子详情
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Post'

  /posts/{postId}/like:
    post:
      summary: 点赞帖子
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 点赞成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: 取消点赞帖子
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 取消点赞成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/likes/detailed:
    get:
      summary: 获取帖子点赞详情（仅作者可见）
      description: 仅帖子作者可以查看详细的点赞用户列表
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功（仅作者可见）
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          totalLikes:
                            type: integer
                          likedUsers:
                            type: array
                            items:
                              type: object
                              properties:
                                userId:
                                  type: integer
                                username:
                                  type: string
                                avatar:
                                  type: string
                                  format: uri
                                likeTime:
                                  type: string
                                  format: date-time
        403:
          description: 无权限查看（非帖子作者）
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/comments:
    get:
      summary: 获取评论列表
      tags: [社区]
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'

    post:
      summary: 发布帖子评论
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
                parentId:
                  type: integer
                  nullable: true
      responses:
        201:
          description: 评论成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          comment:
                            $ref: '#/components/schemas/Comment'
                          commentCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/related-books:
    get:
      summary: 获取帖子相关书籍列表
      tags: [社区]
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            bookId:
                              type: integer
                            cover:
                              type: string
                              format: uri
                            title:
                              type: string
                            author:
                              type: string
                            description:
                              type: string
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /topics/hot:
    get:
      summary: 获取热门话题列表10个
      tags: [话题]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string

  /topics/{topicId}:
    get:
      summary: 获取话题详情页
      tags: [话题]
      security:
        - bearerAuth: []
      parameters:
        - name: topicId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Topic'

  /topics/{topicId}/posts:
    get:
      summary: 获取话题最新/热门/精华帖子列表
      tags: [话题]
      security:
        - bearerAuth: []
      parameters:
        - name: topicId
          in: path
          required: true
          schema:
            type: integer
        - name: sort
          in: query
          required: true
          schema:
            type: string
            enum: [latest, hot, quality]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/Post'
                            - type: object
                              properties:
                                relatedTopics:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      image:
                                        type: string
                                        format: uri
                                      name:
                                        type: string
                                      postCount:
                                        type: integer

  # ==================== 用户中心接口 ====================
  /user/profile:
    get:
      summary: 获取个人资料
      tags: [用户中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfile'

    put:
      summary: 编辑个人信息
      tags: [个人中心]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  minLength: 2
                  maxLength: 20
                  nullable: true
                avatar:
                  type: string
                  format: uri
                  nullable: true
                bio:
                  type: string
                  maxLength: 200
                  nullable: true
      responses:
        200:
          description: 个人信息更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/UserProfile'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /user/home:
    get:
      summary: 获取登录用户个人中心
      tags: [用户中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfile'

  /user/follow/{userId}:
    post:
      summary: 关注用户
      tags: [用户]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 关注成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isFollowing:
                            type: boolean
                          followingCount:
                            type: integer
                          followerCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: 取消关注用户
      tags: [用户]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 取消关注成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isFollowing:
                            type: boolean
                          followingCount:
                            type: integer
                          followerCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 阅读统计接口 ====================
  /reading/statistics:
    get:
      summary: 获取阅读统计数据
      description: 获取用户的阅读统计数据，包括单日阅读时长、总阅读时长、连续阅读天数等
      tags: [阅读统计]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ReadingStat'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /reading/duration:
    post:
      summary: 记录阅读时长
      description: 记录用户阅读时长（分钟）
      tags: [阅读统计]
      security:
        - bearerAuth: []
      parameters:
        - name: minutes
          in: query
          required: true
          schema:
            type: integer
            minimum: 0
          description: 阅读时长（分钟）
      responses:
        200:
          description: 记录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /reading/progress:
    post:
      summary: 记录阅读进度
      description: 记录用户当前阅读进度（书籍、章节、页码）
      tags: [阅读统计]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/ReadingRecordRequest'
      responses:
        200:
          description: 记录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /user/reading-stats/top-books:
    get:
      summary: 获取用户周阅读最久3本
      tags: [阅读统计]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ReadingRecord'

  /user/highlights/recent3:
    get:
      summary: 获取用户最新的3条划线
      description: 返回用户最新的3条划线记录，包括马克笔、波浪线、下划线三种类型
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 3
                        items:
                          $ref: '#/components/schemas/Highlight'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /user/notes/recent6:
    get:
      summary: 获取用户最新的6条笔记
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 6
                        items:
                          $ref: '#/components/schemas/BookNote'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /user/book-reviews/recent4:
    get:
      summary: 获取用户最新的4条书评
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 4
                        items:
                          $ref: '#/components/schemas/BookReview'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  # ==================== 支付相关接口 ====================
  /recharge/packages:
    get:
      summary: 获取充值套餐列表
      tags: [支付]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/RechargePackage'

  /recharge/payment-page:
    get:
      summary: 获取充值支付页
      tags: [支付]
      security:
        - bearerAuth: []
      parameters:
        - name: packageId
          in: query
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentInfo'

  /recharge:
    post:
      summary: 充值充值币
      tags: [支付]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [packageId, paymentMethod]
              properties:
                packageId:
                  type: integer
                paymentMethod:
                  type: string
                  enum: [wechat, alipay, unionpay]
      responses:
        200:
          description: 充值成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          orderId:
                            type: string
                          payAmount:
                            type: number
                            format: float
                          coinAmount:
                            type: integer
                          bonusCoins:
                            type: integer
                          currentCoins:
                            type: integer
                          paymentMethod:
                            type: string
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /rewards/reading:
    post:
      summary: 领取阅读激励
      tags: [阅读激励]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 领取成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rewardDays:
                            type: integer
                          expireDate:
                            type: string
                            format: date
                          isMember:
                            type: boolean
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 搜索相关接口 ====================
  /search:
    get:
      summary: 搜索
      tags: [搜索]
      parameters:
        - name: keyword
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [all, books, authors]
            default: all
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SearchResult'

  # ==================== 书籍管理接口 ====================
  /books:
    post:
      summary: 创建书籍
      tags: [书籍管理]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/BookCreateRequest'
      responses:
        201:
          description: 创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookDetail'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 书籍详情接口 ====================
  /books/{bookId}:
    get:
      summary: 获取书详情
      tags: [书籍详情]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookDetail'

    put:
      summary: 更新书籍信息
      tags: [书籍管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        $ref: '#/components/requestBodies/BookUpdateRequest'
      responses:
        200:
          description: 更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookDetail'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: 删除书籍
      tags: [书籍管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功（软删除，设置为下架）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /books/{bookId}/status:
    put:
      summary: 更新书籍状态
      tags: [书籍管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: isPublished
          in: query
          required: true
          schema:
            type: boolean
          description: 是否上架（true=上架，false=下架）
      responses:
        200:
          description: 状态更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /books/{bookId}/reviews:
    get:
      summary: 获取用户点评3条
      tags: [书籍详情]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            avatar:
                              type: string
                              format: uri
                            username:
                              type: string
                            rating:
                              type: string
                              enum: [recommend, average, not_recommend]
                            reviewTime:
                              type: string
                              format: date-time
                            content:
                              type: string

  /books/{bookId}/author-works:
    get:
      summary: 获取作者代表作3部
      tags: [书籍详情]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            cover:
                              type: string
                              format: uri
                            bookTitle:
                              type: string
                            description:
                              type: string

  /books/{bookId}/related:
    get:
      summary: 获取相关推荐作品3部
      tags: [书籍详情]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            cover:
                              type: string
                              format: uri
                            title:
                              type: string
                            description:
                              type: string

  # ==================== 章节管理接口 ====================
  /books/{bookId}/chapters:
    post:
      summary: 创建章节
      tags: [章节管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        $ref: '#/components/requestBodies/ChapterCreateRequest'
      responses:
        201:
          description: 创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChapterDetail'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: 获取书籍所有章节
      tags: [章节管理]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ChapterDetail'

  /books/{bookId}/chapters/{chapterId}:
    get:
      summary: 获取章节详情
      tags: [章节管理]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChapterDetail'
        404:
          $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: 更新章节
      tags: [章节管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        $ref: '#/components/requestBodies/ChapterCreateRequest'
      responses:
        200:
          description: 更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChapterDetail'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: 删除章节
      tags: [章节管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /books/{bookId}/chapters/{chapterId}/prev:
    get:
      summary: 获取上一章
      tags: [章节管理]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterNumber
          in: query
          required: true
          schema:
            type: integer
          description: 当前章节序号
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChapterDetail'
        404:
          description: 没有上一章
          $ref: '#/components/schemas/ErrorResponse'

  /books/{bookId}/chapters/{chapterId}/next:
    get:
      summary: 获取下一章
      tags: [章节管理]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterNumber
          in: query
          required: true
          schema:
            type: integer
          description: 当前章节序号
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChapterDetail'
        404:
          description: 没有下一章
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 阅读器相关接口 ====================
  /reader/{bookId}/chapters:
    get:
      summary: 获取书籍目录
      tags: [阅读器]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Chapter'

  /reader/{bookId}/chapters/{chapterId}:
    get:
      summary: 获取章节内容（在线阅读）
      tags: [阅读器]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ChapterDetail'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /reader/{bookId}/notes:
    get:
      summary: 获取笔记列表
      tags: [阅读器]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Note'

  # ==================== 书评笔记相关接口 ====================
  /book-reviews:
    post:
      summary: 发布书评
      tags: [书评笔记]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [bookId, rating, content]
              properties:
                bookId:
                  type: integer
                rating:
                  type: string
                  enum: [recommend, average, not_recommend]
                content:
                  type: string
                  minLength: 10
                  maxLength: 2000
                isPublic:
                  type: boolean
                  default: true
      responses:
        201:
          description: 书评发布成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          review:
                            type: object
                            properties:
                              reviewId:
                                type: integer
                              book:
                                $ref: '#/components/schemas/SimpleBook'
                              rating:
                                type: string
                              content:
                                type: string
                              isPublic:
                                type: boolean
                              createdAt:
                                type: string
                                format: date-time
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /notes:
    post:
      summary: 发布笔记
      tags: [书评笔记]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [bookId, quote, noteContent]
              properties:
                bookId:
                  type: integer
                chapterId:
                  type: integer
                  nullable: true
                quote:
                  type: string
                  minLength: 1
                lineType:
                  type: string
                  enum: [marker, wavy, underline]
                  default: marker
                noteContent:
                  type: string
                  minLength: 1
      responses:
        201:
          description: 笔记发布成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          note:
                            type: object
                            properties:
                              noteId:
                                type: integer
                              quote:
                                type: string
                              lineType:
                                type: string
                              noteContent:
                                type: string
                              createdAt:
                                type: string
                                format: date-time
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /notes/{noteId}:
    put:
      summary: 编辑笔记
      tags: [书评笔记]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        $ref: '#/components/requestBodies/NoteUpdateRequest'
      responses:
        200:
          description: 编辑成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          noteId:
                            type: integer
                          content:
                            type: string
                          isPublic:
                            type: boolean
                          color:
                            type: string
                          updatedAt:
                            type: string
                            format: date-time
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        403:
          description: 无权修改他人笔记
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: 删除笔记
      tags: [书评笔记]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        403:
          description: 无权删除他人笔记
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 书签管理接口 ====================
  /bookmarks:
    post:
      summary: 添加书签
      tags: [书签管理]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/BookmarkCreateRequest'
      responses:
        201:
          description: 添加成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Bookmark'
        400:
          description: 书签已存在或其他错误
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: 获取所有书签
      description: 获取当前用户的所有书签列表
      tags: [书签管理]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Bookmark'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /bookmarks/{bookmarkId}:
    delete:
      summary: 删除书签
      tags: [书签管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookmarkId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        403:
          description: 无权删除他人书签
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /bookmarks/book/{bookId}:
    get:
      summary: 获取书籍书签
      description: 获取指定书籍的所有书签
      tags: [书签管理]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Bookmark'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 点赞相关接口 ====================
  /likes:
    post:
      summary: 点赞/取赞
      tags: [点赞]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/LikeRequest'
      responses:
        200:
          description: 操作成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
                          likeTime:
                            type: string
                            format: date-time
                          likedUser:
                            type: object
                            properties:
                              avatar:
                                type: string
                                format: uri
                              username:
                                type: string