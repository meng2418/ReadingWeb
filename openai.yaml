openapi: 3.0.0
info:
  title: 微信读书网页版 API
  description: 根据前端需求整理的接口文档
  version: 2.0.0

servers:
  - url: http://localhost:3000/api/v1
    description: 开发环境

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    # ==================== 通用数据结构 ====================
    ApiResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: "success"
        data:
          type: object
          nullable: true

    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
          example: 400
        message:
          type: string
        details:
          type: string

    # ==================== 书籍相关 ====================
    SimpleBook:
      type: object
      properties:
        cover:
          type: string
          format: uri
          description: 封面图URL
        bookTitle:
          type: string
          description: 书名
        authorName:
          type: string
          description: 作者名
        rating:
          type: number
          format: float
          description: 推荐值
        readCount:
          type: integer
          description: 今日阅读人数
        description:
          type: string
          description: 作品简介
        isFinished:
          type: boolean
          description: 是否读完

    BookDetail:
      allOf:
        - $ref: '#/components/schemas/SimpleBook'
        - type: object
          properties:
            isInBookshelf:
              type: boolean
              description: 是否加入书架
            hasStarted:
              type: boolean
              description: 是否开始阅读
            readingCount:
              type: integer
              description: 在读人数
            finishedCount:
              type: integer
              description: 读完人数
            readingStatus:
              type: string
              enum: [not_started, reading, finished]
              description: 我的阅读状态
            wordCount:
              type: integer
              description: 字数
            publishDate:
              type: string
              format: date
              description: 出版时间
            isFreeForMember:
              type: boolean
              description: 体验卡是否可读
            price:
              type: integer
              description: 电子书价格（分）
            ratingDetail:
              type: object
              properties:
                recommendPercent:
                  type: number
                  format: float
                averagePercent:
                  type: number
                  format: float
                notRecommendPercent:
                  type: number
                  format: float
            ratingCount:
              type: integer
              description: 点评人数
            authorBio:
              type: string
              description: 作者简介

    UserWithFollowVO:
      type: object
      properties:
        userId:
          type: integer
        username:
          type: string
        avatar:
          type: string
          format: uri
        bio:
          type: string
        isFollowing:
          type: boolean
          description: 当前用户是否关注ta
        isFollower:
          type: boolean
          description: ta是否关注当前用户
        followerCount:
          type: integer
        followingCount:
          type: integer

    # ==================== 用户相关 ====================
    UserSimpleVO:
      type: object
      properties:
        userId:
          type: integer
        username:
          type: string
        avatar:
          type: string
          format: uri
        bio:
          type: string
    
    UserProfile:
      type: object
      properties:
        avatar:
          type: string
          format: uri
          description: 用户头像
        username:
          type: string
          description: 用户名
        bio:
          type: string
          description: 用户简介
        followingCount:
          type: integer
          description: 关注数
        followerCount:
          type: integer
          description: 粉丝数
        postCount:
          type: integer
          description: 帖子数
        memberCardCount:
          type: integer
          description: 体验卡数
        coinCount:
          type: integer
          description: 充值币数
        isMember:
          type: boolean
          description: 是否是会员
        memberExpireDays:
          type: integer
          description: 会员剩余天数
        readingStats:
          type: object
          properties:
            weeklyReadingTime:
              type: integer
              description: 周阅读时长（分钟）
            monthlyReadingTime:
              type: integer
              description: 月阅读时长（分钟）
            yearlyReadingTime:
              type: integer
              description: 年阅读时长（分钟）
            totalReadingTime:
              type: integer
              description: 总阅读时长（分钟）
            weeklyReadCount:
              type: integer
              description: 周读过的书数量
            monthlyReadCount:
              type: integer
              description: 月读过的书数量
            yearlyReadCount:
              type: integer
              description: 年读过的书数量
            totalReadCount:
              type: integer
              description: 总读过的书数量
            weeklyFinishedCount:
              type: integer
              description: 周读完的书数量
            monthlyFinishedCount:
              type: integer
              description: 月读完的书数量
            yearlyFinishedCount:
              type: integer
              description: 年读完的书数量
            totalFinishedCount:
              type: integer
              description: 总读完的书数量
            weeklyNoteCount:
              type: integer
              description: 周笔记数量
            monthlyNoteCount:
              type: integer
              description: 月笔记数量
            yearlyNoteCount:
              type: integer
              description: 年笔记数量
            totalNoteCount:
              type: integer
              description: 总笔记数量
        consecutiveReadingDays:
          type: integer
          description: 连续阅读天数

    # ==================== 帖子相关 ====================
    Post:
      type: object
      properties:
        postId:
          type: integer
        authorAvatar:
          type: string
          format: uri
          description: 作者头像
        authorName:
          type: string
          description: 作者名字
        publishTime:
          type: string
          format: date-time
          description: 发布时间
        publishLocation:
          type: string
          description: 发布地点
        isFollowingAuthor:
          type: boolean
          description: 登录用户是否关注作者
        postTitle:
          type: string
          description: 帖子标题
        content:
          type: string
          description: 帖子正文
        mentionedBooks:
          type: array
          items:
            $ref: '#/components/schemas/SimpleBook'
          description: 帖子提及书籍列表
        commentCount:
          type: integer
          description: 评论数
        likeCount:
          type: integer
          description: 点赞数
        isLiked:
          type: boolean
          description: 是否已点赞
        topics:
          type: array
          items:
            type: string
          description: 话题列表

    # ==================== 话题相关 ====================
    Topic:
      type: object
      properties:
        image:
          type: string
          format: uri
          description: 话题图片
        topicName:
          type: string
          description: 话题名称
        postCount:
          type: integer
          description: 话题帖子数
        description:
          type: string
          description: 话题简介
        followerCount:
          type: integer
          description: 话题关注人数
        todayPostCount:
          type: integer
          description: 话题今日发帖数
        isFollowing:
          type: boolean
          description: 是否关注话题
        introduction:
          type: string
          description: 话题介绍内容
        createdAt:
          type: string
          format: date-time
          description: 创建时间
        adminName:
          type: string
          description: 管理员名字
        relatedTopics:
          type: array
          items:
            type: object
            properties:
              image:
                type: string
                format: uri
              topicName:
                type: string
              postCount:
                type: integer

    # ==================== 评论相关 ====================
    Comment:
      type: object
      properties:
        avatar:
          type: string
          format: uri
          description: 评论头像
        username:
          type: string
          description: 评论用户名称
        commentTime:
          type: string
          format: date-time
          description: 评论时间
        content:
          type: string
          description: 评论内容
        likeCount:
          type: integer
          description: 评论点赞数
        replyCount:
          type: integer
          description: 子评论数
        isLiked:
          type: boolean
          description: 是否已点赞
        # 回复目标用户信息
        replyToUsername:
          type: string
          nullable: true
          description: "被回复的用户名，null表示不是回复评论"
        replyToUserId:
          type: integer
          nullable: true
          description: "被回复的用户ID"
        # 简单层级标识（可选）
        isReply:
          type: boolean
          description: "是否是回复评论（replyToUsername不为null）"
    # ==================== 搜索相关 ====================
    SearchResult:
      type: object
      properties:
        books:
          type: array
          items:
            $ref: '#/components/schemas/SimpleBook'
        authors:
          type: array
          items:
            type: object
            properties:
              avatar:
                type: string
                format: uri
              followerCount:
                type: integer
              authorName:
                type: string
              representativeWorks:
                type: array  
                items:
                  type: string
                  description: "代表作列表，如 ['活着', '许三观卖血记']"
              authorBio:
                    type: string

    # ==================== 阅读相关 ====================
    Chapter:
      type: object
      properties:
        startPage:
          type: integer
        chapterNumber:
          type: integer
        chapterName:
          type: string

    Note:
      type: object
      properties:
        markId:
          type: integer
        bookId:
          type: integer
        bookTitle:
          type: string
        chapterId:
          type: integer
          nullable: true
        chapterName:
          type: string
          nullable: true
        quote:
          type: string
          description: "标记的原文"
        startIndex:
          type: integer
          description: "起始位置（字符索引）"
        endIndex:
          type: integer
          description: "结束位置"
        pageNumber:
          type: integer
          nullable: true
          description: "所在页码"
        # 划线类型（可多选）
        lineType:
          type: array
          items:
            type: string
            enum: [marker, wavy, underline]
          nullable: true
          description: "划线类型数组，可同时有多个类型"
        # 笔记内容（可选）
        thought:
          type: string
          nullable: true
          description: "笔记内容，null表示没有笔记"
        noteCreatedAt:
          type: string
          format: date-time
          nullable: true
          description: "笔记创建日期"

    BookNote:
      type: object
      properties:
        bookTitle:
          type: string
        quote:
          type: string
        noteContent:
          type: string
        noteDate:
          type: string
          format: date

    BookReview:
      type: object
      properties:
        cover:
          type: string
          format: uri
        bookTitle:
          type: string
        reviewDate:
          type: string
          format: date
        helpfulCount:
          type: integer
        reviewContent:
          type: string
        rating:
          type: string
          enum: [recommend, average, not_recommend]

    ReadingRecord:
      type: object
      properties:
        cover:
          type: string
          format: uri
        bookTitle:
          type: string
        readingTime:
          type: integer
          description: 阅读时长（分钟）
    ReadingTimeStatItem:
      type: object
      properties:
        time:
          type: string
          description: |
            时间标识：
            - daily: 2024-01-15
            - monthly: 2024-01
            - yearly: 2024
          example: "2024-01"
        readingTime:
          type: integer
          description: 阅读时长（分钟）

    # ==================== 支付相关 ====================
    RechargePackage:
      type: object
      properties:
        coinAmount:
          type: integer
          description: 充值币数
        cnyAmount:
          type: number
          format: float
          description: 人民币数
        bonusCoins:
          type: integer
          description: 赠送充值币数

    PaymentInfo:
      type: object
      properties:
        coinAmount:
          type: integer
          description: 充值币数
        bonusCoins:
          type: integer
          description: 赠送币数
        actualAmount:
          type: number
          format: float
          description: 实付金额
        paymentMethods:
          type: array
          items:
            type: string
            enum: [wechat, alipay, balance, card]
          description: 支付方式

  requestBodies:
    # ==================== 认证相关 ====================
    SendSmsRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'

    RegisterRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              username:
                type: string
                minLength: 2
                maxLength: 20
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'
              verificationCode:
                type: string
                pattern: '^\d{6}$'
              password:
                type: string
                minLength: 6
              confirmPassword:
                type: string
            required: [username, phone, verificationCode, password, confirmPassword]

    LoginRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'
              type:
                type: string
                enum: [password, verificationCode]
              password:
                type: string
                nullable: true
              verificationCode:
                type: string
                nullable: true
            required: [phone, type]

    ResetPasswordRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phone:
                type: string
                pattern: '^1[3-9]\d{9}$'
              verificationCode:
                type: string
                pattern: '^\d{6}$'
              newPassword:
                type: string
                minLength: 6
              confirmPassword:
                type: string
            required: [phone, verificationCode, newPassword, confirmPassword]

    # ==================== 内容发布相关 ====================
    PublishBookReviewRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              bookId:
                type: integer
              rating:
                type: string
                enum: [recommend, average, not_recommend]
              content:
                type: string
                minLength: 1
                maxLength: 1000
                description: "评论内容，1-1000字"
              isPublic:
                type: boolean
                default: true
            required: [bookId, rating, content]

    PublishNoteRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              bookId:
                type: integer
              chapterId:
                type: integer
                nullable: true
              quote:
                type: string
              startIndex:
                type: integer
              endIndex:
                type: integer
              pageNumber:
                type: integer
                nullable: true
              # 划线类型相关（可选）
              addLineTypes:
                type: array
                items:
                  type: string
                  enum: [marker, wavy, underline]
                nullable: true  # 可以为null
                description: "要添加的划线类型，null或空数组表示不添加划线"
              # 笔记内容相关（可选）
              noteContent:
                type: string
                nullable: true
                description: "笔记内容，null表示不添加笔记"
            required: [bookId, quote, startIndex, endIndex]
    PublishPostRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                minLength: 1
              content:
                type: string
                minLength: 1
              bookIds:
                type: array
                items:
                  type: integer
              topics:
                type: array
                items:
                  type: string
            required: [topicTitle, content]

    PublishCommentRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              postId:
                type: integer
              content:
                type: string
                minLength: 1
              replyToCommentId:
                type: integer
                nullable: true
                description: "回复的评论ID，null表示直接评论帖子"
                required: [postId, content]

    # ==================== 用户操作相关 ====================
    UpdateProfileRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              avatar:
                type: string
                format: uri
                nullable: true
              username:
                type: string
                minLength: 2
                maxLength: 20
                nullable: true
              bio:
                type: string
                maxLength: 200
                nullable: true

    RechargeRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              packageId:
                type: integer
              paymentMethod:
                type: string
                enum: [wechat, alipay, unionpay]
            required: [packageId, paymentMethod]

    # ==================== 交互相关 ====================
    FollowRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              userId:
                type: integer
            required: [userId]

    LikeRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              targetId:
                type: integer
              targetType:
                type: string
                enum: [post, comment]
            required: [targetId, targetType]
  parameters:
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        default: 1
        minimum: 1
      description: 页码

    LimitParam:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
      description: 每页数量

paths:
  # ==================== 认证相关接口 ====================
  /auth/send-verification-code:
    post:
      summary: 发送验证码
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone]
              properties:
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
      responses:
        200:
          description: 验证码发送成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'
        429:
          description: 请求过于频繁
          $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      summary: 注册
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, phone, verificationCode, password, confirmPassword]
              properties:
                username:
                  type: string
                  minLength: 2
                  maxLength: 20
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                verificationCode:
                  type: string
                  pattern: '^\d{6}$'
                password:
                  type: string
                  minLength: 6
                confirmPassword:
                  type: string
      responses:
        201:
          description: 注册成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/UserSimpleVO'
                          token:
                            type: string
        400:
          $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      summary: 登录
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, type]
              properties:
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                type:
                  type: string
                  enum: [password, verificationCode]
                password:
                  type: string
                  nullable: true
                verificationCode:
                  type: string
                  nullable: true
      responses:
        200:
          description: 登录成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/UserSimpleVO'
                          token:
                            type: string
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          description: 用户名或密码错误
          $ref: '#/components/schemas/ErrorResponse'
  /auth/reset-password:
    post:
      summary: 找回密码
      tags: [认证]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, verificationCode, newPassword, confirmPassword]
              properties:
                phone:
                  type: string
                  pattern: '^1[3-9]\d{9}$'
                verificationCode:
                  type: string
                  pattern: '^\d{6}$'
                newPassword:
                  type: string
                  minLength: 6
                confirmPassword:
                  type: string
      responses:
        200:
          description: 密码重置成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        400:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 首页相关接口 ====================
  /home/reading-stats:
    get:
      summary: 获取本周/月/总阅读时长
      tags: [首页]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          weeklyReadingTime:
                            type: integer
                            description: 本周阅读时长（分钟）
                            example: 360  # 表示6小时
                          monthlyReadingTime:
                            type: integer
                            description: 本月阅读时长（分钟）
                            example: 1500  # 表示25小时
                          yearlyReadingTime:
                            type: integer
                            description: 今年阅读时长（分钟）
                            example: 8760  # 表示146小时
                          totalReadingTime:
                            type: integer
                            description: 总阅读时长（分钟）
                            example: 28800  # 表示480小时
  /home/recent-books:
    get:
      summary: 获取最近阅读的4本书
      tags: [首页]
      description: 获取用户最近阅读的4本书（按最后阅读时间倒序），只返回封面
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 4
                        items:
                          type: object
                          properties:
                            bookId:
                              type: integer
                            cover:
                              type: string
                              format: uri
  /home/recommendations:
    get:
      summary: 获取猜你想看书籍（6本）
      tags: [首页]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 返回6本推荐书籍
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 6  # 明确6本
                        minItems: 6  # 保证至少6本
                        items:
                          $ref: '#/components/schemas/SimpleBook'

  /home/rankings/{type}:
    get:
      summary: 获取书籍榜单（10本）
      tags: [首页]
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [weekly, monthly, new, masterpiece]
          description: |
            - weekly: 周榜
            - monthly: 月榜  
            - new: 新书榜
            - masterpiece: 神作榜
      responses:
        200:
          description: 返回10本榜单书籍
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 10  # 明确10本
                        minItems: 10  # 保证至少10本
                        items:
                          $ref: '#/components/schemas/SimpleBook'

  # ==================== 分类相关接口 ====================
  /categories:
    get:
      summary: 获取全部分类
      tags: [分类]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            categoryName:
                              type: string

  /categories/{categoryId}/books:
    get:
      summary: 获取分类下的书籍（最多50本）
      tags: [分类]
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50  # 默认50本
            minimum: 1
            maximum: 50  # 限制最多50本
      responses:
        200:
          description: 返回分类书籍列表
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          books:
                            type: array
                            maxItems: 50  # 明确最多50本
                            items:
                              $ref: '#/components/schemas/SimpleBook'
                          total:
                            type: integer
                            description: 该分类下书籍总数
                          page:
                            type: integer
                          limit:
                            type: integer

  # ==================== 书架相关接口 ====================
  /bookshelf:
    get:
      summary: 获取书架全部书籍
      tags: [书架]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/SimpleBook'
                            - type: object
                              properties:
                                readingStatus:
                                  type: string
                                  enum: [unread, reading, finished]
                                  description: 阅读状态

  /bookshelf/{status}:
    get:
      summary: 获取书架未读/在读/读完书籍
      tags: [书架]
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
            enum: [unread, reading, finished]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            cover:
                              type: string
                              format: uri
                            title:
                              type: string
  /bookshelf/batch-remove:
    delete:
      summary: 批量从书架移除书籍
      tags: [书架]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [bookIds]
              properties:
                bookIds:
                  type: array
                  items:
                    type: integer
                  description: "要移除的书籍ID列表"
      responses:
        200:
          description: 批量移除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
  # ==================== 社区相关接口 ====================
  /posts:
    get:
      summary: 获取广场/关注页帖子
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum: [square, following]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

    post:
      summary: 发布帖子
      tags: [社区]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/PublishPostRequest'
      responses:
        201:
          description: 发布成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /posts/{postId}:
    get:
      summary: 获取帖子详情
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Post'
    delete:
      summary: 删除帖子
      description: 只能删除自己的帖子
      tags: [删除操作]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          deletedPostId:
                            type: integer
                          remainingPostCount:
                            type: integer
        401:
          $ref: '#/components/schemas/ErrorResponse'
        403:
          description: 无权限删除此帖子
          $ref: '#/components/schemas/ErrorResponse'
        404:
          description: 帖子不存在
          $ref: '#/components/schemas/ErrorResponse'
  /posts/{postId}/like:
    post:
      summary: 点赞帖子
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 点赞成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: 取消点赞帖子
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 取消点赞成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/likes/detailed:
    get:
      summary: 获取帖子点赞详情（仅作者可见）
      description: 仅帖子作者可以查看详细的点赞用户列表
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功（仅作者可见）
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          totalLikes:
                            type: integer
                          likedUsers:
                            type: array
                            items:
                              type: object
                              properties:
                                userId:
                                  type: integer
                                username:
                                  type: string
                                avatar:
                                  type: string
                                  format: uri
                                likeTime:
                                  type: string
                                  format: date-time
        403:
          description: 无权限查看（非帖子作者）
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

  /posts/{postId}/comments:
    get:
      summary: 获取评论列表
      tags: [社区]
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'
    post:
      summary: 发布帖子评论
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
                parentId:
                  type: integer
                  nullable: true
      responses:
        201:
          description: 评论成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          comment:
                            $ref: '#/components/schemas/Comment'
                          commentCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'
  /comments/{commentId}/like:
    post:
      summary: 点赞评论
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 点赞成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: 取消点赞评论
      tags: [社区]
      security:
        - bearerAuth: []
      parameters:
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 取消点赞成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          $ref: '#/components/schemas/ErrorResponse'
  /comments/{commentId}/reply:
    post:
      summary: 回复评论
      tags: [社区]
      description: 回复指定的评论
      security:
        - bearerAuth: []
      parameters:
        - name: commentId
          in: path
          required: true
          schema:
            type: integer
          description: "要回复的评论ID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 1000
                  description: "回复内容"
      responses:
        201:
          description: 回复成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          comment:
                            type: object
                            properties:
                              commentId:
                                type: integer
                              userId:
                                type: integer
                              username:
                                type: string
                              avatar:
                                type: string
                                format: uri
                              content:
                                type: string
                              commentTime:
                                type: string
                                format: date-time
                              replyToUsername:
                                type: string
                                nullable: true
                                description: "被回复的用户名"
                              parentCommentId:
                                type: integer
                                nullable: true
                          replyCount:
                            type: integer
                            description: "父评论的回复总数"
        400:
          description: 参数错误或不能回复自己
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
        404:
          description: 评论不存在
          $ref: '#/components/schemas/ErrorResponse'
  /posts/{postId}/related-books:
    get:
      summary: 获取帖子相关书籍列表
      tags: [社区]
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            bookId:
                              type: integer
                            cover:
                              type: string
                              format: uri
                            title:
                              type: string
                            author:
                              type: string
                            description:
                              type: string
        404:
          $ref: '#/components/schemas/ErrorResponse'
  
  /topics/hot:
    get:
      summary: 获取热门话题列表10个
      tags: [话题]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 10  
                        items:
                          type: object
                          properties:
                            name:
                              type: string
  /topics/{topicId}:
    get:
      summary: 获取话题详情页
      tags: [话题]
      security:
        - bearerAuth: []
      parameters:
        - name: topicId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Topic'

  /topics/{topicId}/posts:
    get:
      summary: 获取话题最新/热门/精华帖子列表
      tags: [话题]
      security:
        - bearerAuth: []
      parameters:
        - name: topicId
          in: path
          required: true
          schema:
            type: integer
        - name: sort
          in: query
          required: true
          schema:
            type: string
            enum: [latest, hot, quality]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/Post'
                            - type: object
                              properties:
                                relatedTopics:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      image:
                                        type: string
                                        format: uri
                                      topicName:
                                        type: string
                                      postCount:
                                        type: integer
  # ==================== 消息通知接口 ====================
  /messages/my-posts/comments:
    get:
      summary: 获取我的帖子的评论瀑布流
      tags: [消息通知]
      description: 瀑布流方式获取其他用户对我发布的帖子的评论
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          comments:
                            type: array
                            items:
                              type: object
                              properties:
                                commentId:
                                  type: integer
                                postId:
                                  type: integer
                                postTitle:
                                  type: string
                                commenter:
                                  type: object
                                  properties:
                                    userId:
                                      type: integer
                                    username:
                                      type: string
                                    avatar:
                                      type: string
                                      format: uri
                                commentContent:
                                  type: string
                                commentTime:
                                  type: string
                                  format: date-time
                                parentCommentId:
                                  type: integer
                                  nullable: true
                                parentCommentContent:
                                  type: string
                                  nullable: true
                          hasMore:
                            type: boolean
                          nextCursor:
                            type: string
                            nullable: true
  /messages/likes:
    get:
      summary: 获取我的点赞瀑布流
      tags: [消息通知]
      description: 瀑布流方式获取其他用户对我的帖子或评论的点赞
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          likes:
                            type: array
                            items:
                              type: object
                              properties:
                                likeId:
                                  type: integer
                                targetType:
                                  type: string
                                  enum: [post, comment]
                                targetId:
                                  type: integer
                                postTitle:
                                  type: string
                                commentContent:
                                  type: string
                                liker:
                                  type: object
                                  properties:
                                    userId:
                                      type: integer
                                    username:
                                      type: string
                                    avatar:
                                      type: string
                                      format: uri
                                likeTime:
                                  type: string
                                  format: date-time
                          hasMore:
                            type: boolean
                          nextCursor:
                            type: string
                            nullable: true
  # ==================== 个人中心接口 ====================
  /user/home:
    get:
      summary: 获取登录用户个人中心
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfile'
    put:
      summary: 编辑个人信息
      tags: [个人中心]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  minLength: 2
                  maxLength: 20
                  nullable: true
                avatar:
                  type: string
                  format: uri
                  nullable: true
                bio:
                  type: string
                  maxLength: 200
                  nullable: true
      responses:
        200:
          description: 个人信息更新成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          data:
                            type: object
                            properties:
                              username:
                                type: string
                              avatar:
                                type: string
                                format: uri
                              bio:
                                type: string
                                nullable: true
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  # ==================== 关注/粉丝接口 ====================
  /user/following:
    get:
      summary: 获取登录用户关注瀑布流
      tags: [用户关系]
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传，后续传上次返回的nextCursor"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/UserWithFollowVO'
                          hasMore:
                            type: boolean
                            description: "是否还有更多数据"
                          nextCursor:
                            type: string
                            nullable: true
                            description: "下一次请求的游标"

  /user/followers:
    get:
      summary: 获取登录用户粉丝瀑布流
      tags: [用户关系]
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传，后续传上次返回的nextCursor"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/UserWithFollowVO'
                          hasMore:
                            type: boolean
                            description: "是否还有更多数据"
                          nextCursor:
                            type: string
                            nullable: true
                            description: "下一次请求的游标"
  /user/follow/{userId}:
    post:
      summary: 关注用户
      tags: [用户关系]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 关注成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isFollowing:
                            type: boolean
                          followingCount:
                            type: integer
                            description: "当前用户的关注数"
                          followerCount:
                            type: integer
                            description: "被关注用户的粉丝数"
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: 取消关注用户
      tags: [用户关系]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 取消关注成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isFollowing:
                            type: boolean
                          followingCount:
                            type: integer
                            description: "当前用户的关注数"
                          followerCount:
                            type: integer
                            description: "被关注用户的粉丝数"
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 阅读统计接口 ====================
  /user/reading-stats/top-books:
    get:
      summary: 获取用户特定时间段阅读最久的3本书
      tags: [个人中心]
      description: |
        获取用户在不同时间段内阅读时间最长的3本书。
        默认返回本周的数据。
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum: [week, month, year, total]
            default: week
          description: |
            时间段：
            - week: 本周
            - month: 本月  
            - year: 今年
            - total: 总计
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          period:
                            type: string
                            enum: [week, month, year, total]
                            description: "查询的时间段"
                          topBooks:
                            type: array
                            maxItems: 3
                            items:
                              type: object
                              properties:
                                bookId:
                                  type: integer
                                cover:
                                  type: string
                                  format: uri
                                bookTitle:
                                  type: string
                                readingTime:
                                  type: integer
                                  description: "在该时间段内的阅读时长（分钟）"
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /user/highlights/recent:
    get:
      summary: 获取用户最新的3条划线
      description: 返回用户最新的3条划线记录，包括马克笔、波浪线、下划线三种类型
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 3
                        items:
                          $ref: '#/components/schemas/Note'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /user/latest-milestones:
    get:
      summary: 获取用户阅历最新里程碑
      tags: [个人中心]
      description: |
        返回用户每种里程碑类型的最新一条记录（只显示最新达到的里程碑）：
        1. 累计阅读本数里程碑（只显示最新达到的20/40/60...）
        2. 笔记数量里程碑（只显示最新达到的50/100/150...）
        3. 读完本数里程碑（只显示最新达到的10/20/30...）
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          totalReadingMilestone:
                            type: object
                            nullable: true
                            properties:
                              targetCount:
                                type: integer
                                example: 40
                              achievedBookTitle:
                                type: string
                                nullable: true
                              achievedAt:
                                type: string
                                format: date-time
                              message:
                                type: string
                                example: "恭喜！您已累计阅读40本书"
                          noteCountMilestone:
                            type: object
                            nullable: true
                            properties:
                              targetCount:
                                type: integer
                                example: 50
                              achievedBookTitle:
                                type: string
                                nullable: true
                              achievedNoteContent:
                                type: string
                                nullable: true
                              achievedAt:
                                type: string
                                format: date-time
                              message:
                                type: string
                                example: "恭喜！您已创作50条笔记"
                          finishedReadingMilestone:
                            type: object
                            nullable: true
                            properties:
                              targetCount:
                                type: integer
                                example: 10
                              achievedBookTitle:
                                type: string
                                nullable: true
                              achievedAt:
                                type: string
                                format: date-time
                              message:
                                type: string
                                example: "恭喜！您已读完10本书"
  /user/notes/recent:
    get:
      summary: 获取用户最新的6条笔记
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 6
                        items:
                          $ref: '#/components/schemas/BookNote'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /user/posts:
    get:
      summary: 获取登录用户帖子瀑布流
      tags: [个人中心]
      description: 瀑布流方式获取用户发布的帖子
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传，后续传上次返回的nextCursor"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
            maximum: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          posts:
                            type: array
                            items:
                              $ref: '#/components/schemas/Post'
                          hasMore:
                            type: boolean
                          nextCursor:
                            type: string
                            nullable: true
                          postCount:
                            type: integer
                            description: "用户总帖子数"
                          commentCount:
                            type: integer
                            description: "用户所有帖子的总评论数"
                          likeCount:
                            type: integer
                            description: "用户所有帖子的总点赞数"
        401:
          $ref: '#/components/schemas/ErrorResponse'

  /user/notes:
    get:
      summary: 获取登录用户笔记瀑布流
      tags: [个人中心]
      description: 瀑布流方式获取用户的所有笔记
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传，后续传上次返回的nextCursor"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 20
            maximum: 50
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          notes:
                            type: array
                            items:
                              $ref: '#/components/schemas/Note'
                          hasMore:
                            type: boolean
                          nextCursor:
                            type: string
                            nullable: true
                          noteCount:
                              type: integer
                              description: "用户总笔记数"
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /user/book-reviews:
    get:
      summary: 获取登录用户书评瀑布流
      tags: [个人中心]
      description: 瀑布流方式获取用户的所有书评
      security:
        - bearerAuth: []
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: string
            nullable: true
          description: "游标，第一次请求不传，后续传上次返回的nextCursor"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
            maximum: 20
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          reviews:
                            type: array
                            items:
                              $ref: '#/components/schemas/BookReview'
                          hasMore:
                            type: boolean
                          nextCursor:
                            type: string
                            nullable: true
                          reviewCount:
                            type: integer
                            description: "用户总书评数"
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /user/book-reviews/recent:
    get:
      summary: 获取用户最新的4条书评
      tags: [个人中心]
      security:
        - bearerAuth: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 4
                        items:
                          $ref: '#/components/schemas/BookReview'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  # ==================== 支付相关接口 ====================
  /recharge/packages:
    get:
      summary: 获取充值套餐列表
      tags: [支付]
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/RechargePackage'

  /recharge/payment-page:
    get:
      summary: 获取充值支付页
      tags: [支付]
      security:
        - bearerAuth: []
      parameters:
        - name: packageId
          in: query
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentInfo'

  /recharge:
    post:
      summary: 充值充值币
      tags: [支付]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [packageId, paymentMethod]
              properties:
                packageId:
                  type: integer
                paymentMethod:
                  type: string
                  enum: [wechat, alipay, unionpay]
      responses:
        200:
          description: 充值成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          orderId:
                            type: string
                          payAmount:
                            type: number
                            format: float
                          coinAmount:
                            type: integer
                          bonusCoins:
                            type: integer
                          currentCoins:
                            type: integer
                          paymentMethod:
                            type: string
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
          
  /user/reading-stats:
    get:
      summary: 获取用户阅读时长统计
      tags: [个人中心]
      description: |
        获取用户在不同时间维度（每日 / 每月 / 每年）的阅读时长统计数据，
        前端可根据返回数据自行绘制柱形图
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: true
          description: 统计维度
          schema:
            type: string
            enum: [daily, monthly, yearly]
        - name: year
          in: query
          required: false
          description: 查询指定年份（monthly / daily 时使用）
          schema:
            type: integer
            example: 2024
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ReadingTimeStatItem'

  /rewards/reading:
    post:
      summary: 领取阅读激励
      tags: [个人中心]
      description: 用户点击领取按钮，获得体验卡
      security:
        - bearerAuth: []
      responses:
        200:
          description: 领取成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'  
        400:
          description: 今日已领取过或不符合领取条件
          $ref: '#/components/schemas/ErrorResponse'

  # ==================== 搜索相关接口 ====================
  /search:
    get:
      summary: 搜索
      tags: [搜索]
      parameters:
        - name: keyword
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [all, books, authors]
            default: all
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SearchResult'

  # ==================== 书籍详情接口 ====================
  /books/{bookId}:
    get:
      summary: 获取书详情
      tags: [书籍详情]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BookDetail'

  /books/{bookId}/reviews:
    get:
      summary: 获取用户点评3条
      tags: [书籍详情]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 3 
                        items:
                          type: object
                          properties:
                            avatar:
                              type: string
                              format: uri
                            username:
                              type: string
                            rating:
                              type: string
                              enum: [recommend, average,  not_recommend]
                            reviewTime:
                              type: string
                              format: date-time
                            content:
                              type: string
  /books/{bookId}/author-works:
    get:
      summary: 获取作者代表作3部
      tags: [书籍详情]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 3  
                        items:
                          type: object
                          properties:
                            cover:
                              type: string
                              format: uri
                            bookTitle:
                              type: string
                            description:
                              type: string
  /authors/{authorId}:
    get:
      summary: 获取作者详情
      tags: [书籍详情]
      description: 获取作者的详细信息及其所有作品列表
      parameters:
        - name: authorId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          authorId:
                            type: integer
                          authorName:
                            type: string
                          authorBio:
                            type: string
                            description: "作者简介"
                          followerCount:
                            type: integer
                            description: "粉丝数"
                          isFollowing:
                            type: boolean
                            description: "当前用户是否已关注该作者"
                          works:
                            type: array
                            items:
                              type: object
                              properties:
                                bookId:
                                  type: integer
                                bookTitle:
                                  type: string
                                authorName:
                                  type: string
                                cover:
                                  type: string
                                  format: uri
                                rating:
                                  type: number
                                  format: float
                                  description: "推荐值"
                                readCount:
                                  type: integer
                                  description: "今日阅读人数"
                                description:
                                  type: string
                                  description: "作品简介"
                          workCount:
                            type: integer
                            description: "作品总数"
        404:
          description: 作者不存在
          $ref: '#/components/schemas/ErrorResponse'
  /books/{bookId}/related:
    get:
      summary: 获取相关推荐作品3部
      tags: [书籍详情]
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        maxItems: 3  
                        items:
                          type: object
                          properties:
                            cover:
                              type: string
                              format: uri
                            title:
                              type: string
                            description:
                              type: string

  # ==================== 阅读器相关接口 ====================
  /reader/{bookId}/chapters:
    get:
      summary: 获取书籍目录
      tags: [阅读器]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Chapter'
  /books/{bookId}/chapters/{chapterId}:
    get:
      summary: 获取章节信息和内容
      tags: [阅读器]
      description: 一次性获取章节的正文、页数、体验卡要求等信息
      security:
        - bearerAuth: []  # 需要认证（判断是否已解锁）
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          # 基本信息
                          chapterId:
                            type: integer
                          chapterTitle:
                            type: string
                          chapterNumber:
                            type: integer
                            example: 5
                          # 内容相关
                          content:
                            type: string
                            description: "章节正文"
                          totalWords:
                            type: integer
                            example: 3500
                          totalPages:
                            type: integer
                            example: 7
                          wordsPerPage:
                            type: integer
                            example: 500
                            description: "每页字数（根据用户阅读设置）"
                          #收费相关
                          requireExperienceCard:
                            type: boolean
                            description: "是否需要体验卡"
                          isLocked:
                            type: boolean
                            description: "当前用户是否已解锁"
                          # 导航相关
                          prevChapterId:
                            type: integer
                            nullable: true
                          nextChapterId:
                            type: integer
                            nullable: true
                          #阅读进度
                          lastReadPosition:
                            type: integer
                            nullable: true
                            description: "上次阅读到的位置（字符索引）"
        403:
          description: 需要解锁但用户未解锁
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                  message:
                    type: string
                    example: "本章需要解锁"
                  data:
                    type: object
                    properties:
                      requireExperienceCard:
                        type: boolean
                      canUseExperienceCard:
                        type: boolean
        404:
          description: 章节不存在
  /books/{bookId}/chapters/{chapterId}/notes:
    get:
      summary: 获取章节笔记列表
      tags: [阅读器]
      description: 获取指定章节的所有笔记（包括划线、笔记内容等）
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
        - name: chapterId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            noteId:
                              type: integer
                            quote:
                              type: string
                              description: "引用的原文"
                            startIndex:
                              type: integer
                              description: "原文起始位置"
                            endIndex:
                              type: integer
                              description: "原文结束位置"
                            lineType:
                              type: array
                              items:
                                type: string
                                enum: [marker, wavy, underline]
                              nullable: true
                              description: "划线类型，null表示无划线"
                            thought:
                              type: string
                              nullable: true
                              description: "想法，null表示只有划线无笔记"
                            createdAt:
                              type: string
                              format: date-time
                            pageNumber:
                              type: integer
                              nullable: true
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /books/{bookId}/mark-finished:
    put:
      summary: 标记书籍为已读完
      tags: [阅读器]
      description: 用户点击"读完"按钮，更新阅读状态为已读
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 标记成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          bookId:
                            type: integer
                          newStatus:
                            type: string
                            enum: [finished]
                            example: "finished"
                          finishedAt:
                            type: string
                            format: date-time
                          totalFinishedBooks:
                            type: integer
                            description: 用户总共读完的书籍数量
                          milestoneAchieved:
                            type: boolean
                            description: 是否达到里程碑（如第10本、第50本、第100本）
                          milestoneMessage:
                            type: string
                            nullable: true
                            description: 里程碑提示信息，如"恭喜！您已读完100本书！"
        404:
          description: 书籍不存在
        400:
          description: 书籍已是完成状态或其他错误
  /reader/{bookId}/notes:
    get:
      summary: 获取笔记列表
      tags: [阅读器]
      security:
        - bearerAuth: []
      parameters:
        - name: bookId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Note'

  # ==================== 书评笔记相关接口 ====================
  /book-reviews:
    post:
      summary: 发布书评
      tags: [书籍详情]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [bookId, rating, content]
              properties:
                bookId:
                  type: integer
                rating:
                  type: string
                  enum: [recommend, average, not_recommend]
                content:
                  type: string
                  minLength: 10
                  maxLength: 2000
                isPublic:
                  type: boolean
                  default: true
      responses:
        201:
          description: 书评发布成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          review:
                            type: object
                            properties:
                              reviewId:
                                type: integer
                              book:
                                $ref: '#/components/schemas/SimpleBook'
                              avatar:
                                type: string
                              username:
                                type: string
                              rating:
                                type: string
                              content:
                                type: string
                              isPublic:
                                type: boolean
                              createdAt:
                                type: string
                                format: date-time
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /book-reviews/{reviewId}:
    delete:
      summary: 删除书评
      description: 只能删除自己的书评
      tags: [删除操作]
      security:
        - bearerAuth: []
      parameters:
        - name: reviewId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          deletedReviewId:
                            type: integer
                          remainingReviewCount:
                            type: integer
        401:
          $ref: '#/components/schemas/ErrorResponse'
        403:
          description: 无权限删除此书评
          $ref: '#/components/schemas/ErrorResponse'
        404:
          description: 书评不存在
          $ref: '#/components/schemas/ErrorResponse'
  /notes:
    post:
      summary: 发布笔记
      tags: [阅读器]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [bookId, quote]
              properties:
                bookId:
                  type: integer
                chapterId:
                  type: integer
                  nullable: true
                quote:
                  type: string
                  minLength: 1
                lineType:
                  type: string
                  enum: [marker, wavy, underline]
                  default: marker
                noteContent:
                  type: string
                  minLength: 1
      responses:
        201:
          description: 笔记发布成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          note:
                            type: object
                            properties:
                              noteId:
                                type: integer
                              quote:
                                type: string
                              lineType:
                                type: string
                              noteContent:
                                type: string
                              createdAt:
                                type: string
                                format: date-time
        400:
          $ref: '#/components/schemas/ErrorResponse'
        401:
          $ref: '#/components/schemas/ErrorResponse'
  /notes/{noteId}:
    delete:
      summary: 删除笔记
      description: 只能删除自己的笔记
      tags: [删除操作]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: 删除成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          deletedNoteId:
                            type: integer
                          remainingNoteCount:
                            type: integer
        401:
          $ref: '#/components/schemas/ErrorResponse'
        403:
          description: 无权限删除此笔记
          $ref: '#/components/schemas/ErrorResponse'
        404:
          description: 笔记不存在
          $ref: '#/components/schemas/ErrorResponse'
  # ==================== 点赞相关接口 ====================
  /likes:
    post:
      summary: 点赞/取赞帖子或者评论
      tags: [社区]
      security:
        - bearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/LikeRequest'
      responses:
        200:
          description: 操作成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          isLiked:
                            type: boolean
                          likeCount:
                            type: integer
                          likeTime:
                            type: string
                            format: date-time
                          likedUser:
                            type: object
                            properties:
                              avatar:
                                type: string
                                format: uri
                              username:
                                type: string